"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3107],{53107:function(e,t,a){a.r(t),a.d(t,{default:function(){return SecondLayer_SecondDialog}});var n=a(85893),r=a(67294),o=a(38268),i=a(34298),l=a(90571),s=a(73368),d=a(18158),u=a(23185);let c={[s.w.ADD_ADDRESS]:(0,n.jsx)(()=>{var e;let{updateSecondDialogData:t,secondLayer:a,userInfo:o}=(0,l.o)(),[i,s]=(0,r.useState)({});return(0,r.useEffect)(()=>{(0,u.Il)().then(e=>{s(e.data.data)}).catch(()=>{})},[]),(0,n.jsx)(d.tF,{addressGeneralClickHandler:e=>{let{type:a,data:n}=e,r={"change-dialog-data":()=>{t({data:n})}}[a];r&&r()},data:{...null!==(e=null==a?void 0:a.data)&&void 0!==e?e:{},userInfo:o.userInfo,statesAndCities:i}})},{})},p={[s.w.ADD_ADDRESS]:(0,n.jsx)(()=>{var e;let{addAddress:t,closeSecondDialog:a,openThirdDialog:r,secondLayer:o,updateSecondDialogData:i}=(0,l.o)();return(0,n.jsx)(d.M$,{addressGeneralClickHandler:e=>{let{type:n,data:o}=e,l={"change-dialog-data":()=>{i({data:o})},"confirm-address":()=>{r({config:{open:!0,title:"ویرایش کردن آدرس",type:s.w.CONFIRM_DIALOG},data:{...o,headerText:"آیا از ویرایش آدرس مطمئن هستید؟"}})},"add-address":()=>{t({address:o})},"cancel-add-address":()=>{a()},"close-dialog":()=>a()}[n];l&&l()},data:{...null!==(e=null==o?void 0:o.data)&&void 0!==e?e:{}}})},{})};var m=a(16829);let getLocaleTime=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Date(e).toLocaleTimeString(t,{timeStyle:"short",hour12:!1})};function totalMinutes(e){var t=e.split(":");return 60*+t[0]+ +t[1]}let sumOfTwoTimesInMinutes=(e,t)=>{var a=totalMinutes(e);return totalMinutes(t)+a},getNumberOfTimeIntervals=(e,t,a)=>Math.floor((totalMinutes(t)-totalMinutes(e))/a),convertMinsToHrsMins=e=>{let t=Math.floor(e/60),a=e%60;return t=t<10?"0"+t:t,a=a<10?"0"+a:a,"".concat(t,":").concat(a)},makeHoursDoubleDigit=e=>{let t=e.split(":");return 1===t[0].length?"0".concat(t[0],":").concat(t[1]):e},separateTimesIntoTileIntervals=(e,t,a,n)=>a.map(a=>{let{timeFrom:r,timeTo:o}=a,i=[],l=e.defaultServiceDetails.duration,s=e.defaultServiceDetails.interval,d=getLocaleTime("".concat(n.split("T")[0],"T").concat(makeHoursDoubleDigit(r),":00.").concat(n.split(".")[1])),u=getLocaleTime("".concat(n.split("T")[0],"T").concat(makeHoursDoubleDigit(o),":00.").concat(n.split(".")[1])),c=sumOfTwoTimesInMinutes(l,s),p=getNumberOfTimeIntervals(d,u,c);for(let e=0;e<p;e++){let a=convertMinsToHrsMins(totalMinutes(d)+e*c),n=convertMinsToHrsMins(totalMinutes(a)+totalMinutes(l));i.push({timeFrom:a,timeTo:n,isReserved:!!t.find(e=>totalMinutes(a)<totalMinutes(e.timeTo)-1&&totalMinutes(e.timeTo)-1<totalMinutes(n))})}return i});var g=a(82729);function _templateObject(){let e=(0,g._)(["\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 6px;\n  margin:12px 0;\n\n  @media (max-width: 600px) {\n    grid-template-columns: repeat(3, 1fr);\n    gap: 8px;\n  },\n"]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,g._)(["\n  border-radius: 4px;\n  border: 1px solid ",";\n  background-color: ",";\n  color: ",";\n  font-weight: ",";\n  width: 100%;\n  padding: 6px;\n  text-align: center;\n  font-size: 14px;\n  cursor: pointer;\n\n  &.crosshatch {\n    background-image: linear-gradient(\n      35deg,\n      rgba(240, 240, 240, 3.5) 66%,\n      transparent 25%,\n      transparent 50%,\n      rgba(0, 0, 0, 0.5) 50%,\n      rgba(0, 0, 0, 0.5) 75%,\n      transparent 75%,\n      transparent\n    );\n    background-size: 5px 5px;\n    cursor: not-allowed;\n  }\n"]);return _templateObject1=function(){return e},e}let h=m.Z.div(_templateObject()),v=m.Z.div(_templateObject1(),i.VZ.GRAY_4,e=>{let{selected:t}=e;return t?i.VZ.BLUE_LIGHTEST:i.VZ.WHITE},e=>{let{selected:t}=e;return t?i.VZ.PRIMARY_11:"black"},e=>{let{selected:t}=e;return t?"bold":"400"}),y=m.Z.div({width:"100%",textAlign:"center"}),f={[s.w.RESERVATION_SHOW_TIMES]:(0,n.jsx)(()=>{var e,t;let{secondLayer:a}=(0,l.o)(),[o,s]=(0,r.useState)(),d=null==a?void 0:null===(e=a.data)||void 0===e?void 0:e.service,u=null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.selectedDate;return(0,n.jsx)(h,{children:(0,n.jsx)(e=>{var t,a,r,l,c,p;let{reserves:m=[]}=e,g=[],h=new Date(u).getDay()+1,f=null==d?void 0:null===(a=d.customServiceDetails)||void 0===a?void 0:null===(t=a.specificDate)||void 0===t?void 0:t.find(e=>new Date(e.date).getDay()===new Date(u).getDay()),x=null==d?void 0:null===(l=d.customServiceDetails)||void 0===l?void 0:null===(r=l.daysOfWeek)||void 0===r?void 0:r.find(e=>e.dayOfWeek===h);if(f){if((null==f?void 0:null===(c=f.times)||void 0===c?void 0:c.length)===0)return(0,n.jsx)(y,{children:"زمانی در این روز تعیین نشده است"});g=separateTimesIntoTileIntervals(d,m,f.times,u)}else if(x){if((null==x?void 0:null===(p=x.times)||void 0===p?void 0:p.length)===0)return(0,n.jsx)(y,{children:"زمانی در این روز تعیین نشده است"});g=separateTimesIntoTileIntervals(d,m,x.times,u)}else{let e=d.defaultServiceDetails;g=separateTimesIntoTileIntervals(d,m,[{timeFrom:e.timeFrom,timeTo:e.timeTo}],u)}let toggleTime=e=>s(o===e?null:e);return g.flat().map((e,t)=>(0,n.jsx)(v,{className:e.isReserved?"crosshatch":null,onClick:()=>!e.isReserved&&toggleTime(t),selected:t===o,children:"".concat((0,i.U1)(e.timeFrom)," تا ").concat((0,i.U1)(e.timeTo))},"reserve"+t))},{})})},{})};var x=a(75790);let w={[s.w.DATE_TIME_PICKER]:(0,n.jsx)(()=>{let{secondLayer:e,dialog:t,updateSecondDialogData:a}=(0,l.o)(),o={weekdays:["sunday","monday","wednesday"],work_hour_start:"09:00:00",work_hour_end:"17:00:00",service_duration:"00:45:00",gap_between_services:"00:15:00"},[s,d]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[p,m]=(0,r.useState)(null),[g,h]=(0,r.useState)(null),handleUpdateYear=e=>{a({data:{year:e}}),d(e)},handleUpdateMonth=e=>{a({data:{month:e}}),c(e)},handleUpdateDay=e=>{a({data:{day:e}}),m(e)},handleUpdateTime=e=>{a({data:{time:e}}),h(e)},generateTimeSlots=()=>{let e=[],[t,a]=o.work_hour_start.split(":").map(Number),[n,r]=o.work_hour_end.split(":").map(Number),l=new Date(0,0,0,t,a),s=new Date(0,0,0,n,r),[d,u]=o.service_duration.split(":").map(Number),[c,p]=o.gap_between_services.split(":").map(Number);for(;l<s;){let t=new Date(l.getTime());if(t.setHours(l.getHours()+d),t.setMinutes(l.getMinutes()+u),t>s)break;e.push("".concat((0,i.U1)(l.getHours().toString().padStart(2,"0")),":").concat((0,i.U1)(l.getMinutes().toString().padStart(2,"0"))," تا ")+"".concat((0,i.U1)(t.getHours().toString().padStart(2,"0")),":").concat((0,i.U1)(t.getMinutes().toString().padStart(2,"0")))),l.setHours(l.getHours()+d+c),l.setMinutes(l.getMinutes()+u+p)}return e};return(0,n.jsx)("div",{style:{textAlign:"center"},children:s?u?p?(0,n.jsx)(n.Fragment,{children:(()=>{let e=generateTimeSlots();return(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"auto auto auto",rowGap:8,columnGap:8},children:e.map((e,t)=>(0,n.jsx)("button",{onClick:()=>handleUpdateTime(e),style:{padding:"10px",backgroundColor:g===e?i.VZ.GRAY_1:i.VZ.WHITE,cursor:"pointer",color:g===e?i.VZ.GRAY_10:i.VZ.GRAY_4,border:g===e?"2px solid ".concat(i.VZ.GRAY_10):"0.5px solid ".concat(i.VZ.GRAY_4),borderRadius:"4px",fontFamily:"iransans"},children:e},t))})})()}):(0,n.jsx)(n.Fragment,{children:(()=>{let e=["saturday","sunday","monday","tuesday","wednesday","thursday","friday"],t=Array.from("5".repeat(62)),a=new Date(s,u,1).getDay();for(let n=1;n<=31;n++){let r=new Date(s,u,n);if(r.getMonth()===u){let i=e[r.getDay()];t[a+n-1]={day:n,weekday:i,disabled:!o.weekdays.includes(i.toLowerCase())}}}return(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto auto auto auto auto auto auto",rowGap:8,columnGap:8},children:[["شنبه","یکشنبه","دوشنبه","سه‌شنبه","چهارشنه","پنجشنبه","جمعه"].map(e=>(0,n.jsx)("p",{style:{color:i.VZ.GRAY_10,fontSize:"12px",margin:0,textAlign:"center",width:"100%"},children:e},e)),t.map((e,t)=>"5"!==e?(0,n.jsx)("button",{disabled:e.disabled,onClick:()=>handleUpdateDay(e.day),style:{width:40,height:40,backgroundColor:p===e.day?"#ddd":"#fff",color:i.VZ.GRAY_10,opacity:e.disabled?.2:1,cursor:e.disabled?"not-allowed":"pointer",border:"1px solid ".concat(i.VZ.GRAY_3),fontFamily:"iransans"},children:(0,i.U1)(e.day)},e.day):(0,n.jsx)("div",{},e+t))]})})()}):(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"auto auto auto",rowGap:8,columnGap:8},children:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"].map((e,t)=>(0,n.jsx)("button",{onClick:()=>handleUpdateMonth(t),style:{padding:"10px",color:u===t?i.VZ.BLACK:i.VZ.GRAY_5,cursor:"pointer",border:"none",backgroundColor:"transparent",fontFamily:"iransans"},children:e},t))})}):(0,n.jsx)(n.Fragment,{children:(()=>{let e=Array.from({length:16},(e,t)=>parseInt(new Date().toLocaleDateString("fa-IR-u-nu-latn").split("/")[0])+t);return(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"auto auto auto auto",rowGap:8,columnGap:8},children:e.map(e=>(0,n.jsx)("button",{onClick:()=>handleUpdateYear(e),style:{padding:"10px",color:s===e?i.VZ.BLACK:i.VZ.GRAY_5,cursor:"pointer",border:"none",backgroundColor:"transparent",fontFamily:"iransans"},children:(0,i.U1)(e)},e))})})()})})},{})},T={[s.w.DATE_TIME_PICKER]:(0,n.jsx)(()=>{let{secondLayer:e,closeSecondDialog:t,updateData:a}=(0,l.o)();return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%"},children:[(0,n.jsx)(x.W,{onCustomClick:()=>t(),variant:"text",text:"انصراف",customStyles:{width:"26%"}}),(0,n.jsx)(x.W,{variant:"contained",text:"تایید",onCustomClick:()=>{a({data:{...e.data}}),t()},customStyles:{width:"70%"},disabled:!e.data.year||!e.data.month||!e.data.day||!e.data.time})]})},{})},b={...c,...f,...w},_={...p,...T};var SecondLayer_SecondDialog=()=>{var e;let{secondLayer:t,closeSecondDialog:a}=(0,l.o)(),{open:s,title:d,type:u,transitionDirection:c,hasCloseButton:p,hasBackButton:m,hasMenuButton:g,action:h,customStyles:v={},titleContainerCustomStyle:y}=null!==(e=t.config)&&void 0!==e?e:{},f={...v,"& .MuiDialog-container":{direction:"rtl",fontFamily:"iransans"},"& .MuiDialogActions-root":{backgroundColor:i.VZ.WHITE}};return(0,r.useEffect)(()=>{if(s||"secondLayer"!==window.history.state||window.history.back(),s)return s&&window.history.pushState("secondLayer","",""),window.addEventListener("popstate",e=>{!["secondLayer","thirdLayer"].includes(window.history.state)&&s&&a()}),()=>{window.removeEventListener("popstate",()=>{a()})}},[s]),(0,n.jsx)(o.V,{open:s,handleClose:()=>a(),title:d,content:b[u],footer:_[u],transitionDirection:c,hasCloseButton:p,hasBackButton:m,hasMenuButton:g,action:h,customStyles:f,titleContainerCustomStyle:y})}}}]);